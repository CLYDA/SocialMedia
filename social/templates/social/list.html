{% if tag %}
    <h2>Posts tagged with "{{ tag.name }}"</h2>
{% else %}
    <h2>All Posts</h2>
{% endif %}


<div id="post-list" >
{% for post in posts %}
    <a href="{{ post.get_absolute_url }}">
        {{ post.description|truncatewords:20|linebreaks }}
    </a>

    published at {{ post.created}} by {{ post.author}}
    <br>
    {% for tag in post.tags.all %}
    <a href="{% url 'social:post_list_by_tag' tag.slug %}"> {{ tag.name }} </a>

    {% if not forloop.last %} , {% endif %}
    {% endfor %}
    <hr>
{% endfor %} 

</div>

<button id="load-more" >بارگزاری بیشتر</button>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>  
<script>
    $(document).ready(function() {
        var page = 2;  // Start from the second page since the first is already loaded

        $('#load-more').click(function() {
            $.ajax({
                type: 'GET',
                url: "{% if tag %} {% url 'social:post_list_by_tag' tag.slug %} {% else %} {% url 'social:post_list' %}{% endif %}" + "?page=" +  page,
               dataType: 'html',
                success: function(data) {
                    $('#post-list').append(data);
                    page += 1;  
                },
                
               
            });
        });
    });
</script>

{% comment %} success: function(data) {
                    if ($.trim(data) == '') {
                        $('#load-more').prop('disabled', true).text('پستی وجود ندارد');
                    } else {
                        $('#post-list').append(data);
                        page += 1;
                    }
                } {% endcomment %}