<div class="post" data-post-id="{{ post.id }}" >

{{ post.description|linebreaks }}
published at {{ post.created}} by {{ post.author}}
<br>

<button class="like-button" >
    {% if request.user in post.likes.all %}
        <span class="unlike">Unlike</span>
    {% else %}
        <span class="like">Like</span>
    {% endif %}
     
</button>
<span class="likes_count" > {{ post.likes.count }} </span> Likes

</div>

<br>

<button class="save-post" >
    {% if user in post.saved_by.all %}
        Unsave
    {% else %}
        Save
    {% endif %}
</button>
   
<br>
{% for tag in post.tags.all %}
    <a href="{% url 'social:post_list_by_tag' tag.slug %}"> {{ tag.name }} </a>
    {% if not forloop.last %} , {% endif %}
{% endfor %}



<h1>similar posts</h1>
{% for post in similar_post %}
    <h2><a href="{{ post.get_absolute_url }}">{{ post.description|truncatewords:10 }}</a></h2>

{% empty %}
    <p>No similar posts found.</p>
{% endfor %}


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    $('.like-button').click(function() {
        var post_id = $(this).closest('.post').data('post-id');
        var button = $(this);

        $.ajax({
            type: 'POST',
            url: '{% url 'social:like_post' %}',
            data: {
                'post_id': post_id,
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function(data) {
                if (data.liked) {
                    button.text('Unlike');
                } else {
                    button.text('Like');
                }
                $('.likes_count').text(data.likes_count);
            },
        });
    });
    $('.save-post').click(function() {
        var button = $(this);

        $.ajax({
            type: 'POST',
            url: '{% url 'social:save_post' %}',
            data: {
                'post_id': {{ post.id }},
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function(data) {
                if (data.saved) {
                    button.text('Unsave');
                } else {
                    button.text('Save');
                }
            },
            error: function(error) {
                console.log('خطا در ارسال درخواست ajax'+error   );
            }
        });
    });
});
</script>